<div id="root">
  <div id="group-list">
    <div class="group-icon" [class.selected]="currentGroup == groupID" *ngFor="let groupID of objectKeys(groupList)"
      (click)="selectGroup(groupID)">
      <span>{{ groupList[groupID].name | initials }}</span>
    </div>

    <div class="group-icon" id="new-group" (click)="addGroup()" *ngIf="user.hasPermission('group_admin')">
      <img src="/assets/icons/plus.svg">
    </div>
  </div>

  <div id="sidebar">
    <div id="channel-toolbar">
      <ng-container *ngIf="currentGroup !== undefined">
        <span>{{ groupList[currentGroup].name }}</span>

        <!-- TODO add group assist to this -->
        <div class="image-button" (click)="addChannel()" *ngIf="user.hasPermission('group_admin') || isAssistant()">
          <img src="/assets/icons/plus.svg">
        </div>
      </ng-container>
    </div>

    <div id="channel-list">
      <ng-container *ngIf="currentGroup !== undefined">
        <div class="channel-selector" [class.selected]="currentChannel == channelID"
          *ngFor="let channelID of objectKeys(channelList)" (click)="selectChannel(channelID)">
          <img src="/assets/icons/hash.svg">
          <span>{{ channelList[channelID].name }}</span>

          <div class="image-button clear" (click)="deleteChannel(channelID)"
            [class.invisible]="currentChannel != channelID || !user.hasPermission('group_admin')">
            <img src="/assets/icons/cross.svg">
          </div>
        </div>
      </ng-container>
    </div>

    <div id="user-info-box">
      <img src="/assets/icons/account.svg">
      <span id="username">{{ user.name }}</span>

      <div class="image-button" (click)="dashboard()">
        <img src="/assets/icons/settings.svg">
      </div>

      <div class="image-button danger" (click)="logout()">
        <img src="/assets/icons/exit.svg">
      </div>
    </div>
  </div>

  <div id="chat-region">
    <div id="chat-toolbar">
      <div id="chat-title">
        <ng-container *ngIf="currentChannel !== undefined">
          <img src="/assets/icons/hash.svg">
          <span>{{ channelList[currentChannel].name }}</span>
        </ng-container>
      </div>

      <!-- TODO add group assist to this -->
      <ng-container *ngIf="currentChannel !== undefined">
        <div class="image-button" (click)="addUser()" *ngIf="user.hasPermission('group_admin') || isAssistant()">
          <img src="/assets/icons/account-add.svg">
        </div>
      </ng-container>
    </div>

    <div id="chat-main">
      <div id="chat-area">
        <div id="chat">

        </div>

        <div id="chatbox-container">
          <input type="text" id="chatbox"
            [placeholder]="currentChannel !== undefined ? 'Message #' + channelList[currentChannel].name : ''" />
        </div>
      </div>

      <div id="user-list">
        <ng-container *ngIf="currentChannel !== undefined">
          <h3>Offline &ndash; {{ channelList[currentChannel].members.length }}</h3>

          <div class="user-selector" *ngFor="let member of channelList[currentChannel].members">
            <span [class.assistant]="isAssistant(member)">{{ member }}</span>

            <ng-container *ngIf="user.hasPermission('group_admin')">
              <div class="image-button clear" (click)="removeAssistant(member)" *ngIf="isAssistant(member)">
                <img src="/assets/icons/shield-remove.svg">
              </div>

              <div class="image-button clear" (click)="addAssistant(member)" *ngIf="!isAssistant(member)">
                <img src="/assets/icons/shield-plus.svg">
              </div>
            </ng-container>

            <div class="image-button clear" [class.invisible]="!user.hasPermission('group_admin') && !isAssistant()">
              <img src="/assets/icons/cross.svg">
            </div>
          </div>
        </ng-container>
      </div>
    </div>
  </div>
</div>


<modal-dialog id="modal-create-group">
  <h1>Create Group</h1>
  <form (onsubmit)="doAddGroup()">
    <input name="name" type="text" [(ngModel)]="newGroupName" placeholder="Group Name" />

    <div class="action-row">
      <button (click)="cancelAddGroup()">Cancel</button>
      <button class="primary-action" (click)="doAddGroup()">Create</button>
    </div>
  </form>
</modal-dialog>


<modal-dialog id="modal-create-channel">
  <h1>Create Channel</h1>
  <form (onsubmit)="doAddChannel()">
    <input name="name" type="text" [(ngModel)]="newChannelName" placeholder="channel-name" />

    <div class="action-row">
      <button (click)="cancelAddChannel()">Cancel</button>
      <button class="primary-action" (click)="doAddChannel()">Create</button>
    </div>
  </form>
</modal-dialog>


<modal-dialog id="modal-add-user">
  <h1>Add User to Channel</h1>
  <form (onsubmit)="doAddUser()">
    <input name="name" type="text" [(ngModel)]="newUserName" placeholder="user_name" />

    <div class="action-row">
      <button (click)="cancelAddUser()">Cancel</button>
      <button class="primary-action" (click)="doAddUser()">Add User</button>
    </div>
  </form>
</modal-dialog>
